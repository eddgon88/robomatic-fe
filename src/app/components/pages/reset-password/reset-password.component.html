<div class="reset-password-container">
    <!-- Lado izquierdo - Branding -->
    <div class="branding-side">
        <div class="branding-content">
            <div class="logo-container">
                <img src="assets/images/logo_ROBOMATIC.png" alt="Robomatic" class="logo">
            </div>
            <div class="branding-text">
                <h2>Create New Password</h2>
                <p>Your new password must be different from previously used passwords.</p>
            </div>
            <div class="security-badge">
                <i class="bi bi-shield-check"></i>
                <span>Secure Connection</span>
            </div>
        </div>
    </div>

    <!-- Lado derecho - Formulario -->
    <div class="form-side">
        <div class="form-container">
            <!-- Link de regreso -->
            <a class="back-link" (click)="goToLogin()">
                <i class="bi bi-arrow-left"></i>
                Back to Login
            </a>

            <!-- Loading mientras valida token -->
            <div *ngIf="validatingToken" class="loading-content">
                <div class="loading-animation">
                    <div class="loading-circle">
                        <span class="spinner-large"></span>
                    </div>
                </div>
                <h1>Validating Link</h1>
                <p class="subtitle">Please wait while we verify your recovery link...</p>
            </div>

            <!-- Token inválido o expirado -->
            <div *ngIf="!validatingToken && !tokenValid" class="error-content">
                <div class="error-animation">
                    <div class="error-circle">
                        <i class="bi bi-x-lg"></i>
                    </div>
                </div>

                <h1>Link Invalid</h1>
                <p class="error-message">{{ tokenError }}</p>

                <div class="info-card error">
                    <div class="info-item">
                        <i class="bi bi-exclamation-triangle"></i>
                        <span>The link may have <strong>expired</strong> or already been used</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn-primary" (click)="requestNewLink()">
                        <i class="bi bi-envelope"></i>
                        Request New Link
                    </button>
                    <button class="btn-secondary" (click)="goToLogin()">
                        <i class="bi bi-box-arrow-in-right"></i>
                        Back to Login
                    </button>
                </div>
            </div>

            <!-- Formulario para nueva contraseña -->
            <div *ngIf="!validatingToken && tokenValid && !resetSuccess" class="form-content">
                <div class="form-header">
                    <div class="icon-circle">
                        <i class="bi bi-lock"></i>
                    </div>
                    <h1>Reset Password</h1>
                    <p class="subtitle" *ngIf="maskedEmail">Creating new password for <strong>{{ maskedEmail }}</strong></p>
                </div>

                <div class="form-body">
                    <div class="input-group" [class.focused]="passwordFocused">
                        <label for="newPassword">
                            <i class="bi bi-key"></i>
                            New Password
                        </label>
                        <div class="password-input-wrapper">
                            <input 
                                [(ngModel)]="newPassword" 
                                id="newPassword" 
                                name="newPassword" 
                                [type]="showPassword ? 'text' : 'password'"
                                placeholder="Enter new password"
                                [disabled]="resetting"
                                (focus)="passwordFocused = true"
                                (blur)="passwordFocused = false">
                            <button type="button" class="toggle-password" (click)="showPassword = !showPassword">
                                <i class="bi" [ngClass]="showPassword ? 'bi-eye-slash' : 'bi-eye'"></i>
                            </button>
                        </div>
                    </div>

                    <div class="input-group" [class.focused]="confirmFocused">
                        <label for="confirmPassword">
                            <i class="bi bi-key-fill"></i>
                            Confirm Password
                        </label>
                        <div class="password-input-wrapper">
                            <input 
                                [(ngModel)]="confirmPassword" 
                                id="confirmPassword" 
                                name="confirmPassword" 
                                [type]="showConfirmPassword ? 'text' : 'password'"
                                placeholder="Confirm new password"
                                [disabled]="resetting"
                                (focus)="confirmFocused = true"
                                (blur)="confirmFocused = false"
                                (keyup.enter)="resetPassword()">
                            <button type="button" class="toggle-password" (click)="showConfirmPassword = !showConfirmPassword">
                                <i class="bi" [ngClass]="showConfirmPassword ? 'bi-eye-slash' : 'bi-eye'"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Password strength indicator -->
                    <div class="password-requirements">
                        <div class="requirement" [class.met]="newPassword.length >= 6">
                            <i class="bi" [ngClass]="newPassword.length >= 6 ? 'bi-check-circle-fill' : 'bi-circle'"></i>
                            <span>At least 6 characters</span>
                        </div>
                        <div class="requirement" [class.met]="newPassword && newPassword === confirmPassword">
                            <i class="bi" [ngClass]="newPassword && newPassword === confirmPassword ? 'bi-check-circle-fill' : 'bi-circle'"></i>
                            <span>Passwords match</span>
                        </div>
                    </div>

                    <button 
                        class="btn-primary" 
                        [disabled]="resetting || !newPassword || newPassword.length < 6 || newPassword !== confirmPassword"
                        (click)="resetPassword()">
                        <span *ngIf="!resetting">
                            <i class="bi bi-check2-circle"></i>
                            Update Password
                        </span>
                        <span *ngIf="resetting" class="loading-state">
                            <span class="spinner"></span>
                            Updating...
                        </span>
                    </button>
                </div>
            </div>

            <!-- Éxito -->
            <div *ngIf="resetSuccess" class="success-content">
                <div class="success-animation">
                    <div class="checkmark-circle">
                        <i class="bi bi-check-lg"></i>
                    </div>
                    <div class="success-ripple"></div>
                </div>

                <h1>Password Updated!</h1>
                <p class="success-message">
                    Your password has been successfully reset.<br>
                    You can now log in with your new password.
                </p>

                <div class="info-card success">
                    <div class="info-item">
                        <i class="bi bi-shield-check"></i>
                        <span>Your account is now <strong>secured</strong></span>
                    </div>
                </div>

                <button class="btn-primary" (click)="goToLogin()">
                    <i class="bi bi-box-arrow-in-right"></i>
                    Sign In Now
                </button>
            </div>
        </div>
    </div>
</div>
