<div class="create-edit-container">
  <!-- Header -->
  <div class="page-header">
    <button class="btn-back" (click)="cancel()">
      <i class="bi bi-arrow-left"></i>
    </button>
    <div class="header-content">
      <h1>{{ isEditMode ? 'Edit Schedule' : 'Create Schedule' }}</h1>
      <p>{{ isEditMode ? 'Modify your test schedule configuration' : 'Configure a new automated test schedule' }}</p>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading schedule...</p>
  </div>

  <!-- Form -->
  <div class="form-container" *ngIf="!loading">
    <!-- Basic Info Section -->
    <section class="form-section">
      <div class="section-header">
        <i class="bi bi-info-circle"></i>
        <h2>Basic Information</h2>
      </div>
      
      <div class="form-group">
        <label for="name">Schedule Name <span class="required">*</span></label>
        <input 
          type="text" 
          id="name" 
          [(ngModel)]="name" 
          placeholder="e.g., Daily Morning Run"
          class="form-input">
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea 
          id="description" 
          [(ngModel)]="description" 
          placeholder="Optional description for this schedule"
          rows="3"
          class="form-input"></textarea>
      </div>

      <div class="form-group" *ngIf="!isEditMode">
        <label for="test">Select Test <span class="required">*</span></label>
        <div class="select-wrapper">
          <select 
            id="test" 
            [(ngModel)]="selectedTestId" 
            class="form-select"
            [disabled]="loadingTests">
            <option [ngValue]="null" disabled>{{ loadingTests ? 'Loading tests...' : 'Select a test' }}</option>
            <option *ngFor="let test of availableTests" [ngValue]="test.id">
              {{ test.name }}
            </option>
          </select>
          <i class="bi bi-chevron-down select-icon"></i>
        </div>
        <p class="form-hint" *ngIf="availableTests.length === 0 && !loadingTests">
          No tests available. Create a test first.
        </p>
      </div>
    </section>

    <!-- Trigger Type Section -->
    <section class="form-section">
      <div class="section-header">
        <i class="bi bi-clock"></i>
        <h2>Schedule Type</h2>
      </div>

      <div class="trigger-options">
        <div 
          class="trigger-option" 
          [class.active]="triggerType === 'cron'"
          (click)="triggerType = 'cron'">
          <i class="bi bi-calendar2-week"></i>
          <div class="trigger-info">
            <h3>Recurring (Cron)</h3>
            <p>Run on specific days and times</p>
          </div>
        </div>

        <div 
          class="trigger-option" 
          [class.active]="triggerType === 'interval'"
          (click)="triggerType = 'interval'">
          <i class="bi bi-arrow-repeat"></i>
          <div class="trigger-info">
            <h3>Interval</h3>
            <p>Run every X hours/minutes</p>
          </div>
        </div>

        <div 
          class="trigger-option" 
          [class.active]="triggerType === 'date'"
          (click)="triggerType = 'date'">
          <i class="bi bi-calendar-check"></i>
          <div class="trigger-info">
            <h3>One-time</h3>
            <p>Run once at a specific date</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Cron Configuration -->
    <section class="form-section" *ngIf="triggerType === 'cron'">
      <div class="section-header">
        <i class="bi bi-gear"></i>
        <h2>Cron Configuration</h2>
      </div>

      <div class="form-group">
        <label>Time to Run <span class="required">*</span></label>
        <div class="time-inputs">
          <div class="time-input-group">
            <label>Hour</label>
            <input 
              type="number" 
              [(ngModel)]="cronHour" 
              min="0" 
              max="23"
              class="form-input time-input">
          </div>
          <span class="time-separator">:</span>
          <div class="time-input-group">
            <label>Minute</label>
            <input 
              type="number" 
              [(ngModel)]="cronMinute" 
              min="0" 
              max="59"
              class="form-input time-input">
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>Days to Run <span class="required">*</span></label>
        <div class="days-selector">
          <button 
            *ngFor="let day of daysOfWeek"
            type="button"
            class="day-btn"
            [class.active]="isDaySelected(day.value)"
            (click)="toggleDay(day.value)">
            {{ day.label }}
          </button>
        </div>
      </div>
    </section>

    <!-- Interval Configuration -->
    <section class="form-section" *ngIf="triggerType === 'interval'">
      <div class="section-header">
        <i class="bi bi-gear"></i>
        <h2>Interval Configuration</h2>
      </div>

      <div class="interval-inputs">
        <div class="form-group">
          <label>Days</label>
          <input 
            type="number" 
            [(ngModel)]="intervalDays" 
            min="0"
            class="form-input">
        </div>
        <div class="form-group">
          <label>Hours</label>
          <input 
            type="number" 
            [(ngModel)]="intervalHours" 
            min="0" 
            max="23"
            class="form-input">
        </div>
        <div class="form-group">
          <label>Minutes</label>
          <input 
            type="number" 
            [(ngModel)]="intervalMinutes" 
            min="0" 
            max="59"
            class="form-input">
        </div>
      </div>
      <p class="form-hint">At least one field must be greater than 0</p>
    </section>

    <!-- Date Configuration -->
    <section class="form-section" *ngIf="triggerType === 'date'">
      <div class="section-header">
        <i class="bi bi-gear"></i>
        <h2>Date Configuration</h2>
      </div>

      <div class="date-inputs">
        <div class="form-group">
          <label>Date <span class="required">*</span></label>
          <input 
            type="date" 
            [(ngModel)]="runDate"
            class="form-input">
        </div>
        <div class="form-group">
          <label>Time <span class="required">*</span></label>
          <input 
            type="time" 
            [(ngModel)]="runTime"
            class="form-input">
        </div>
      </div>
    </section>

    <!-- Preview Section -->
    <section class="form-section preview-section">
      <div class="section-header">
        <i class="bi bi-eye"></i>
        <h2>Schedule Preview</h2>
      </div>
      <div class="preview-box">
        <i class="bi bi-calendar-event"></i>
        <span>{{ getSchedulePreview() }}</span>
      </div>
    </section>

    <!-- Actions -->
    <div class="form-actions">
      <button class="btn-cancel" (click)="cancel()" [disabled]="saving">
        Cancel
      </button>
      <button 
        class="btn-save" 
        (click)="save()" 
        [disabled]="!isFormValid() || saving">
        <span *ngIf="!saving">
          <i class="bi" [ngClass]="isEditMode ? 'bi-check-lg' : 'bi-plus-lg'"></i>
          {{ isEditMode ? 'Save Changes' : 'Create Schedule' }}
        </span>
        <span *ngIf="saving" class="saving-state">
          <span class="spinner-small"></span>
          Saving...
        </span>
      </button>
    </div>
  </div>
</div>


